aoiVersion: v1 
kind: Deployment 
metadata: 
    name: mysql 
    namespace: roboshop 
    #deployment labels
    labels: 
       component: mysql 
       project: roboshop 
       tier: database 
spec: 
   replicas: 1
   # These are the labels replicaset use to create pod replicas, this should match pod labels 
   selector: 
      matchLabels: 
         component: mysql 
         project: roboshop 
         tier: database 
      # this is pod definition 
      template: 
         metadata: 
            labels: 
               component: mysql 
               project: roboshop 
               tier: database 
         spec: 
            serviceAccount: roboshop-mysql-secret-reader 
            volumes: 
            - name: mysql-secret 
              emptyDir: {} 
            containers: 
            - name: mysql 
              image: subbu2/mysql:v1 
              imagePullPolicy: Always 
              volumeMounts: 
              - name: mysql-secret 
                mountPath: /tmp 
            initContainers: 
            - name: fetch-secret 
              image: amazon/aws-cli 
              command: 
              - sh
              - c 
              - l 
                      aws secretsmanager get-secret-value --secret-id roboshop/mysql/password --query SecretString --output text | jq -r '.MYSQL_ROOT_PASSWORD' > /tmp/mysql_root_password.txt 
              volumeMounts: 
              - name: mysql-secret 
                mountPath: /tmp
--- 
apiVersion: v1 
kind: Service 
metadata: 
     name: mysql 
     namespace: roboshop 
     labels: 
       component: mysql 
       project: roboshop 
       tier: database 
spec: 
   selector: 
      component: mysql 
      project: roboshop 
      tier: database 
   ports: 
   - protocol: TCP 
     port: 3306 #service port 
     targetPort: 3306 # container port                            
